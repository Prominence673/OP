<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KAPIFLY - Panel de Administración</title>
  <link rel="stylesheet" href="../CSS/admin.css" />
  <style>
.tabla-productos {
  width: 100%;
  border-collapse: collapse;
}
.tabla-productos th, .tabla-productos td {
  border: 1px solid #ccc;
  padding: 6px 10px;
  text-align: left;
}
.tabla-productos th {
  background: #f5f5f5;
}
.tabla-productos img {
  display: block;
  max-width: 80px;
  max-height: 50px;
}
.btn-accion {
  border: none;
  background: none;
  font-size: 1.2em;
  cursor: pointer;
  margin: 0 2px;
  transition: color 0.2s;
}
.btn-accion:hover {
  color: #c00;
}
.btn-modificar:hover { color: #0077cc; }
.btn-agregar:hover { color: #090; }
</style>
</head>
<body>

<div class="admin-container">

  <aside class="admin-sidebar">
    <h2 class="logo">Admin</h2>
    <nav class="admin-nav">
      <ul>
        <li><a href="#" data-section="inicio">Inicio</a></li>
        <li>
          <a href="#" data-section="productos" class="has-submenu">Productos</a>
        <ul class="submenu">
          <li><a href="#" data-subsection="ver-productos">Ver productos</a></li>
          <li><a href="#" data-subsection="agregar-producto">Agregar producto</a></li>
          <li><a href="#" data-subsection="modificar-producto">Modificar producto</a></li>
          <li><a href="#" data-subsection="eliminar-producto">Eliminar producto</a></li>
        </ul>
        </li>
        <li><a href="index.html">Salir</a></li>
      </ul>
    </nav>
  </aside>

  <main class="admin-main">
    <header class="admin-header">
      <h1>Panel de Administración</h1>
    </header>

  <section id="inicio" class="contenido-seccion">
    <div class="welcome-card">
      <div class="welcome-icon">👋</div>
      <div class="welcome-text">
        <h2>¡Bienvenido, Administrador!</h2>
        <p>Gestioná tus productos, usuarios y pedidos de forma rápida y eficiente desde este panel.</p>
      </div>
    </div>
  </section>
      <div id="ver-productos" class="contenido-seccion" hidden>
        <h2>Listado de productos</h2>
        <label for="tipo-producto">Ver:</label>
        <select id="tipo-producto">
          <option value="coches">Autos</option>
          <option value="paquetes">Paquetes</option>
          <option value="estadias">Estadías</option>
          <option value="pasajes">Pasajes</option>
        </select>
        <div id="tabla-productos-container" style="margin-top:1em;"></div>
      </div>


      <div id="agregar-producto" class="contenido-seccion" hidden>
        <h2>Agregar nuevo producto</h2>
        <form id="form-insert-producto" enctype="multipart/form-data" class="form-admin">
          <label>Tabla:
            <select name="tabla" id="tabla-insertar" required>
              <option value="autos">Autos</option>
              <option value="pasajes">Pasajes</option>
              <option value="paquetes">Paquetes</option>
              <option value="estadias">Estadías</option>
            </select>
          </label>
          <div id="campos-insertar"></div>
          <button type="submit">Insertar Producto</button>
          <div class="msg" id="msg-insert-producto"></div>
        </form>
      </div>


      <div id="modificar-producto" class="contenido-seccion" hidden>
        <h2>Modificar Producto</h2>
        <form id="form-modificar-producto" class="form-admin">
          <label>Tabla:
            <select name="tabla" required>
              <option value="autos">Autos</option>
              <option value="pasajes">Pasajes</option>
              <option value="paquetes">Paquetes</option>
              <option value="estadias">Estadías</option>
            </select>
          </label>
          <label>ID: <input name="id" type="number" required></label>
          <label>Nombre: <input name="nombre"></label>
          <label>Imagen (URL o nombre): <input name="imagen"></label>
          <label>Tipo/Aerolínea/Duración/Ubicación: <input name="tipo"></label>
          <label>Capacidad/Clase/Incluye/Descripción: <input name="capacidad"></label>
          <label>Precio/Precio desde/Precio aprox: <input name="precio"></label>
          <input type="hidden" name="accion" value="modificar">
          <button type="submit">Modificar</button>
          <div class="msg" id="msg-modificar"></div>
        </form>
      </div>


      <div id="eliminar-producto" class="contenido-seccion" hidden>
        <h2>Eliminar Producto</h2>
        <form id="form-borrar-producto" class="form-admin">
          <label>Tabla:
            <select name="tabla" required>
              <option value="autos">Autos</option>
              <option value="pasajes">Pasajes</option>
              <option value="paquetes">Paquetes</option>
              <option value="estadias">Estadías</option>
            </select>
          </label>
          <label>
            Eliminar por:
            <select id="eliminar-por" name="eliminar_por">
              <option value="id">ID</option>
              <option value="nombre">Nombre</option>
            </select>
          </label>
          <div id="campo-eliminar">
            <label>ID: <input name="id" type="number" required></label>
          </div>
          <input type="hidden" name="accion" value="borrar">
          <button type="submit">Borrar</button>
          <div class="msg" id="msg-borrar"></div>
        </form>
      </div>
       <script src="../../BACK/JS LOGICA/submitdata.js"></script>
      <script src="../../BACK/JS LOGICA/submitfiles.js"></script>
      <script>

        new FileUploader({
          formSelector: "#form-insert-auto",
          fileInputName: "imagen",
          endpoint: "../../BACK/PHP/admin_abm_productos.php",
          messageTarget: document.getElementById("msg-insert-auto")
        });


        new FormHandler({
          formSelector: "#form-insert-pasaje",
          endpoint: "../../BACK/PHP/admin_abm_productos.php",
          messageTarget: document.getElementById("msg-insert-pasaje")
        });

  
        new FormHandler({
          formSelector: "#form-insert-paquete",
          endpoint: "../../BACK/PHP/admin_abm_productos.php",
          messageTarget: document.getElementById("msg-insert-paquete")
        });


        new FormHandler({
          formSelector: "#form-insert-estadia",
          endpoint: "../../BACK/PHP/admin_abm_productos.php",
          messageTarget: document.getElementById("msg-insert-estadia")
        });

      
        new FormHandler({
          formSelector: "#form-modificar-producto",
          endpoint: "../../BACK/PHP/admin_abm_productos.php",
          messageTarget: document.getElementById("msg-modificar")
        });


        new FormHandler({
          formSelector: "#form-borrar-producto",
          endpoint: "../../BACK/PHP/admin_abm_productos.php",
          messageTarget: document.getElementById("msg-borrar")
        });

       
        document.querySelectorAll('.admin-nav a[data-section], .admin-nav a[data-subsection]').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
         
            document.querySelectorAll('.contenido-seccion').forEach(sec => sec.hidden = true);

    
            if (this.dataset.section) {
              document.getElementById(this.dataset.section).hidden = false;
            }
            if (this.dataset.subsection) {
              document.getElementById(this.dataset.subsection).hidden = false;
            }
  
            document.querySelectorAll('.admin-nav a[data-section], .admin-nav a[data-subsection]').forEach(link => {
            link.addEventListener('click', function(e) {
              e.preventDefault();
        
              document.querySelectorAll('.contenido-seccion').forEach(sec => sec.hidden = true);

             
              if (this.dataset.section) {
                document.getElementById(this.dataset.section).hidden = false;
              }
              if (this.dataset.subsection) {
                document.getElementById(this.dataset.subsection).hidden = false;
              }
            });
          });
          });
        });
      </script>

      

    </section>

    <footer class="admin-footer">
      <p>&copy; 2025 - Panel de Administración</p>
    </footer>
      <script src="../../BACK/JS LOGICA/sessionActivate.js"></script>
      <script>
      const actions = new SessionActions();
      actions.Disabled(["#login_panel", "#register_panel"],"none", "0.5"); 
      actions.checkSessionAndRedirectIfNotLoggedIn("login.html");
      </script>
    
      <script src="../JS DISEÑO/menu.js"></script>
      
  </main>
</div>

<script src="../JS DISEÑO/admin.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("tipo-producto");
  const tablaContainer = document.getElementById("tabla-productos-container");

  function renderTable(tipo, data) {
    if (!Array.isArray(data) || data.length === 0) {
      tablaContainer.innerHTML = "<p>No hay datos para mostrar.</p>";
      return;
    }
    let headers = [];
    switch (tipo) {
      case "coches":
        headers = ["ID", "Nombre", "Imagen", "Tipo", "Capacidad", "Precio", "Imagen Interior", "Acciones"];
        break;
      case "paquetes":
        headers = ["ID", "Nombre del viaje", "Imagen", "Duración", "Incluye", "Precio aprox", "Acciones"];
        break;
      case "estadias":
        headers = ["ID", "Nombre", "Imagen", "Ubicación", "Descripción", "Precio", "Acciones"];
        break;
      case "pasajes":
        headers = ["ID", "Nombre", "Imagen", "Aerolínea", "Duración", "Precio desde", "Clase", "Acciones"];
        break;
    }
    let html = "<table class='tabla-productos'><thead><tr>";
    headers.forEach(h => html += `<th>${h}</th>`);
    html += "</tr></thead><tbody>";
    data.forEach(row => {
      html += "<tr>";
      switch (tipo) {
        case "coches":
          html += `<td>${row.id_autos}</td>
                   <td>${row.nombre}</td>
                   <td><img src="${row.imagen}" alt="" style="max-width:80px;max-height:50px;"></td>
                   <td>${row.tipo}</td>
                   <td>${row.capacidad}</td>
                   <td>$${row.precio}</td>
                   <td><img src="${row.imagen_interior}" alt="" style="max-width:80px;max-height:50px;"></td>`;
          break;
        case "paquetes":
          html += `<td>${row.id_paquetes}</td>
                   <td>${row.nombre_viaje}</td>
                   <td><img src="${row.imagen}" alt="" style="max-width:80px;max-height:50px;"></td>
                   <td>${row.duracion}</td>
                   <td>${row.incluye}</td>
                   <td>$${row.precio_aprox}</td>`;
          break;
        case "estadias":
          html += `<td>${row.id_estadias}</td>
                   <td>${row.nombre}</td>
                   <td><img src="${row.imagen}" alt="" style="max-width:80px;max-height:50px;"></td>
                   <td>${row.ubicacion}</td>
                   <td>${row.descripcion}</td>
                   <td>$${row.precio}</td>`;
          break;
        case "pasajes":
          html += `<td>${row.id_pasajes}</td>
                   <td>${row.nombre}</td>
                   <td><img src="${row.imagen}" alt="" style="max-width:80px;max-height:50px;"></td>
                   <td>${row.aerolinea}</td>
                   <td>${row.duracion}</td>
                   <td>$${row.precio_desde}</td>
                   <td>${row.clase}</td>`;
          break;
      }
    
      html += `<td>
        <button class="btn-accion btn-eliminar" title="Eliminar" data-id="${row.id_autos || row.id_paquetes || row.id_estadias || row.id_pasajes}" data-tipo="${tipo}">🗑️</button>
        <button class="btn-accion btn-modificar" title="Modificar" data-id="${row.id_autos || row.id_paquetes || row.id_estadias || row.id_pasajes}" data-tipo="${tipo}">✏️</button>
        <button class="btn-accion btn-agregar" title="Añadir" data-tipo="${tipo}">＋</button>
      </td>`;
      html += "</tr>";
    });
    html += "</tbody></table>";
    tablaContainer.innerHTML = html;

   
    document.querySelectorAll('.btn-eliminar').forEach(btn => {
      btn.onclick = function() {
        abrirEliminarProducto(this.dataset.tipo, this.dataset.id);
      };
    });
    document.querySelectorAll('.btn-modificar').forEach(btn => {
      btn.onclick = function() {
        abrirModificarProducto(this.dataset.tipo, this.dataset.id);
      };
    });
    document.querySelectorAll('.btn-agregar').forEach(btn => {
      btn.onclick = function() {
        abrirAgregarProducto(this.dataset.tipo);
      };
    });
  }

  function cargarProductos(tipo) {
    fetch("../../BACK/PHP/productos_api.php?tipo=" + tipo)
      .then(res => res.json())
      .then(data => renderTable(tipo, data))
      .catch(() => {
        tablaContainer.innerHTML = "<p>Error al cargar los productos.</p>";
      });
  }

  select.addEventListener("change", () => {
    cargarProductos(select.value);
  });


  cargarProductos(select.value);
});
</script>
<script>
const camposPorTabla = {
  autos: `
    <label>Nombre: <input name="nombre" required></label>
    <label>Tipo: <input name="tipo" required></label>
    <label>Capacidad: <input name="capacidad" type="number" required></label>
    <label>Precio: <input name="precio" type="number" required></label>
    <label>Imagen (URL o nombre): <input name="imagen" required></label>
    <label>Imagen Interior (URL o nombre): <input name="imagen_interior"></label>
  `,
  pasajes: `
    <label>Nombre: <input name="nombre" required></label>
    <label>Imagen (URL o nombre): <input name="imagen" required></label>
    <label>Aerolínea: <input name="aerolinea" required></label>
    <label>Duración: <input name="duracion" required></label>
    <label>Precio desde: <input name="precio_desde" type="number" required></label>
    <label>Clase: <input name="clase" required></label>
  `,
  paquetes: `
    <label>Nombre del viaje: <input name="nombre_viaje" required></label>
    <label>Imagen (URL o nombre): <input name="imagen" required></label>
    <label>Duración: <input name="duracion" required></label>
    <label>Incluye: <input name="incluye" required></label>
    <label>Precio aprox: <input name="precio_aprox" type="number" required></label>
  `,
  estadias: `
    <label>Nombre: <input name="nombre" required></label>
    <label>Imagen (URL o nombre): <input name="imagen" required></label>
    <label>Ubicación: <input name="ubicacion" required></label>
    <label>Descripción: <input name="descripcion" required></label>
    <label>Precio: <input name="precio" type="number" required></label>
  `
};

document.addEventListener("DOMContentLoaded", () => {
  const selectTabla = document.getElementById("tabla-insertar");
  const camposDiv = document.getElementById("campos-insertar");
  function mostrarCampos() {
    camposDiv.innerHTML = camposPorTabla[selectTabla.value];
  }
  selectTabla.addEventListener("change", mostrarCampos);
  mostrarCampos();

 
  new FormHandler({
    formSelector: "#form-insert-producto",
    endpoint: "../../BACK/PHP/admin_abm_productos.php",
    messageTarget: document.getElementById("msg-insert-producto")
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const eliminarPor = document.getElementById("eliminar-por");
  const campoEliminar = document.getElementById("campo-eliminar");
  function mostrarCampoEliminar() {
    if (eliminarPor.value === "id") {
      campoEliminar.innerHTML = '<label>ID: <input name="id" type="number" required></label>';
    } else {
      campoEliminar.innerHTML = '<label>Nombre: <input name="nombre" required></label>';
    }
  }
  eliminarPor.addEventListener("change", mostrarCampoEliminar);
  mostrarCampoEliminar();

 
});
</script>
<script>
function abrirEliminarProducto(tabla, id) {
  document.querySelectorAll('.contenido-seccion').forEach(sec => sec.hidden = true);
  document.getElementById('eliminar-producto').hidden = false;
  document.querySelector('#eliminar-producto select[name="tabla"]').value = tabla === "coches" ? "autos" : tabla;
  document.getElementById('eliminar-por').value = "id";
  document.getElementById('campo-eliminar').innerHTML = `<label>ID: <input name="id" type="number" value="${id}" required></label>`;
}

function abrirModificarProducto(tabla, id) {
  document.querySelectorAll('.contenido-seccion').forEach(sec => sec.hidden = true);
  document.getElementById('modificar-producto').hidden = false;
  document.querySelector('#modificar-producto select[name="tabla"]').value = tabla === "coches" ? "autos" : tabla;
  document.querySelector('#modificar-producto input[name="id"]').value = id;
}

function abrirAgregarProducto(tabla) {
  document.querySelectorAll('.contenido-seccion').forEach(sec => sec.hidden = true);
  document.getElementById('agregar-producto').hidden = false;
  document.getElementById('tabla-insertar').value = tabla === "coches" ? "autos" : tabla;

  document.getElementById('tabla-insertar').dispatchEvent(new Event('change'));
}
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const selectUsuario = document.getElementById("tipo-usuario");
  const tablaUsuariosContainer = document.getElementById("tabla-usuarios-container");

  function renderUsuariosTable(tipo, data) {
    if (!Array.isArray(data) || data.length === 0) {
      tablaUsuariosContainer.innerHTML = "<p>No hay datos para mostrar.</p>";
      return;
    }
    let headers = Object.keys(data[0]);
    let html = "<table class='tabla-productos'><thead><tr>";
    headers.forEach(h => html += `<th>${h}</th>`);
    html += "<th>Acciones</th></tr></thead><tbody>";
    data.forEach(row => {
      html += "<tr>";
      headers.forEach(h => html += `<td>${row[h]}</td>`);
      html += `<td>
        <button class="btn-accion btn-eliminar" title="Eliminar" data-id="${row.id_usuario || row.id_dato || row.id_tarjeta || row.id_pedido || row.id_provincia || row.id_partido || row.id_localidad || row.id_detallepedido || row.id_opinion || row.id_rol}" data-tipo="${tipo}">🗑️</button>
        <button class="btn-accion btn-modificar" title="Modificar" data-id="${row.id_usuario || row.id_dato || row.id_tarjeta || row.id_pedido || row.id_provincia || row.id_partido || row.id_localidad || row.id_detallepedido || row.id_opinion || row.id_rol}" data-tipo="${tipo}">✏️</button>
        <button class="btn-accion btn-agregar" title="Añadir" data-tipo="${tipo}">＋</button>
      </td>`;
      html += "</tr>";
    });
    html += "</tbody></table>";
    tablaUsuariosContainer.innerHTML = html;


    asignarEventosAccion(tipo);
  }

  function cargarUsuarios(tipo) {
    fetch("../../BACK/PHP/admin_tablas_api.php?tabla=" + tipo)
      .then(res => res.json())
      .then(data => renderUsuariosTable(tipo, data))
      .catch(() => {
        tablaUsuariosContainer.innerHTML = "<p>Error al cargar los datos.</p>";
      });
  }

  selectUsuario.addEventListener("change", () => {
    cargarUsuarios(selectUsuario.value);
  });
  cargarUsuarios(selectUsuario.value);
});
</script>
</body>
</html>
