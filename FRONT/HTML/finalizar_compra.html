<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra | Travel Rock Argentina</title>
    <link rel="stylesheet" href="../CSS/header-footer.css">
    <link rel="stylesheet" href="../CSS/checkout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-container">
      <div class="logo-titulo">
        <img src="../../SOURCE/logo.png" alt="Logo Kapifly" class="logo-img">
        <span>KAPIFLY</span>
      </div>
      <nav class="main-nav">
        <ul class="nav-menu">
          <li><a href="index.html">Inicio</a></li>
          <li class="dropdown-parent">
            <button class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">
              Paquetes <i class="fa-solid fa-chevron-down"></i>
            </button>
            <ul class="submenu">
              <li><a href="coches.html">Alquiler coches</a></li>
              <li><a href="paquetes.html">Paquetes turisticos</a></li>
              <li><a href="estadias.html">Estadias</a></li>
              <li><a href="pasajes.html">Pasajes aéreos</a></li>
            </ul>
          </li>
          <li><a href="contacto.html">Contacto</a></li>
        </ul>
      </nav>
      <div class="user-menu">
        <a href="carrito.html" aria-label="Ir al carrito de compras" class="icon-link">
          <i class="fa-solid fa-cart-shopping user-icon"></i>
        </a>
        <button id="user-menu-btn" aria-label="Menú de usuario" class="icon-btn">
          <i class="fa-solid fa-user user-icon"></i>
        </button>
        <ul class="dropdown">
            <li id="user"></li>
            <li id="panel_usuario"><a href="panel_usuario.html">Panel</a></li>
            <li id="login_panel"><a href="login.html">Iniciar sesión</a></li>
            <li id="register_panel"><a href="register.html">Registrarse</a></li>
            <li><a href="#" id="logout">Cerrar Sesion</a></li>
          </ul>
      </div>
  </header>

    <main class="checkout-container">
        <div class="checkout-steps">
            <div class="step active">1. Carrito</div>
            <div class="step active">2. Confirmacion</div>
        </div>

        <div class="checkout-grid">
            <div class="payment-section">
                <h2><i class="fa-solid fa-credit-card"></i> Método de Pago</h2>
                
                <div class="payment-methods">
                    <div class="payment-method active" data-method="credit">
                        <i class="fa-solid fa-credit-card"></i> Tarjeta de Crédito
                    </div>
                    <div class="payment-method" data-method="debit">
                        <i class="fa-regular fa-credit-card"></i> Tarjeta de Débito
                    </div>
                    <div class="payment-method" data-method="cash">
                        <i class="fa-solid fa-money-bill-wave"></i> Efectivo en Sucursal
                    </div>
                </div>


                  <form id="formCredit" class="credit-card-form" style="display: none;">
                        <div class="form-group">
                            <label for="nombre_credito">Nombre</label>
                            <input type="text" id="nombre_credito" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="apellido_credito">Apellido</label>
                            <input type="text" id="apellido_credito" name="apellido" required>
                        </div>
                        <div class="form-group">
                            <label for="dni_credito">DNI</label>
                            <input type="text" id="dni_credito" name="dni" maxlength="8" required>
                        </div>
                        <div class="form-group">
                            <label for="card-number">Número de Tarjeta</label>
                            <div class="input-with-icon">
                                <i class="fa-solid fa-credit-card"></i>
                                <input type="text" id="card-number" name="numero" placeholder="1234 5678 9012 3456" maxlength="19" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="card-name">Nombre en la Tarjeta</label>
                            <input type="text" id="card-name" name="nombre_tarjeta" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="card-expiry">Fecha de Expiración</label>
                                <input type="text" id="card-expiry" name="vencimiento" maxlength="5" required>
                            </div>
                            <div class="form-group">
                                <label for="card-cvv">CVV</label>
                                <input type="text" id="card-cvv" name="cvv" maxlength="3" required>
                            </div>
                        </div>
                        <div class="form-group" id="installments-group">
                            <label for="card-installments">Cuotas</label>
                            <select id="card-installments" name="cuotas" required>
                                <option value="">Seleccione cuotas</option>
                                <option value="1">1 cuota</option>
                                <option value="3">3 cuotas</option>
                                <option value="6">6 cuotas</option>
                            </select>
                        </div>
                        <div class="message-target"></div>
                        <button type="submit" class="btn-pay">
                            <i class="fa-solid fa-lock"></i> CONFIRMAR PAGO<span class="total-amount"></span>
                        </button>
                    </form>

                      <form id="formDebit" class="credit-card-form" style="display: none;">
                          <div class="form-group">
                              <label for="nombre_debito">Nombre</label>
                              <input type="text" id="nombre_debito" name="nombre" required>
                          </div>
                          <div class="form-group">
                              <label for="apellido_debito">Apellido</label>
                              <input type="text" id="apellido_debito" name="apellido" required>
                          </div>
                          <div class="form-group">
                              <label for="dni_debito">DNI</label>
                              <input type="text" id="dni_debito" name="dni" maxlength="8" required>
                          </div>
                          <div class="form-group">
                              <label for="card-number-debit">Número de Tarjeta</label>
                              <div class="input-with-icon">
                                  <i class="fa-solid fa-credit-card"></i>
                                  <input type="text" id="card-number-debit" name="numero" placeholder="1234 5678 9012 3456" maxlength="19" required>
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="card-name-debit">Nombre en la Tarjeta</label>
                              <input type="text" id="card-name-debit" name="nombre_tarjeta" required>
                          </div>
                          <div class="form-row">
                              <div class="form-group">
                                  <label for="card-expiry-debit">Fecha de Expiración</label>
                                  <input type="text" id="card-expiry-debit" name="vencimiento" maxlength="5" required>
                              </div>
                              <div class="form-group">
                                  <label for="card-cvv-debit">CVV</label>
                                  <input type="text" id="card-cvv-debit" name="cvv" maxlength="3" required>
                              </div>
                          </div>
                          <div class="message-target"></div>
                          <button type="submit" class="btn-pay">
                              <i class="fa-solid fa-lock"></i> CONFIRMAR PAGO<span class="total-amount"></span>
                          </button>
                      </form>
                  


                
                    <form id="formEfec" style="display: none;">
                      <div id="cash-message" class="cash-message">
                    <h3><i class="fa-solid fa-money-bill-wave"></i> Pago en Efectivo</h3>
                    <p>Al confirmar, recibirás un código para pagar en cualquiera de nuestras sucursales.</p>
                    <p><strong>Dirección:</strong> Av. Principal 1234, Buenos Aires</p>
                    <p><strong>Horario:</strong> Lunes a Viernes de 9:00 a 18:00</p>
                    </div>
                    <div class="form-group">
                      <label for="nombre_efectivo">Nombre</label>
                      <input type="text" id="nombre_efectivo" name="nombre" required>
                    </div>
                    <div class="form-group">
                      <label for="apellido_efectivo">Apellido</label>
                      <input type="text" id="apellido_efectivo" name="apellido" required>
                    </div>
                    <div class="form-group">
                      <label for="dni_efectivo">DNI</label>
                      <input type="text" id="dni_efectivo" name="dni" maxlength="8" required>
                    </div>
                    <div class="message-target"></div>
                    <button id="confirm-cash" class="btn-pay">
                        <i class="fa-solid fa-check"></i> CONFIRMAR PAGO<span class="total-amount"></span>
                    </button>
                  </form> 
                </div>
            

            <div class="summary-section">
                <h2><i class="fa-solid fa-cart-shopping"></i> Resumen de Compra</h2>
                
                <div class="order-summary" id="order-summary">

                </div>

                <div class="summary-totals">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row" id="descuento-row" style="display:none;">
                        <span>Descuento</span>
                        <span id="descuento">- $0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span id="summary-total">$0.00</span>
                    </div>
                </div>
                

                <div class="secure-payment">
                    <i class="fa-solid fa-lock"></i>
                    <span>Pago seguro • Todos tus datos están protegidos</span>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer center">
        <p>&copy; 2025 KAPIFLY. Todos los derechos reservados.</p>
    </footer>
    <script src="../../BACK/JS LOGICA/submitdata.js"></script>
    <script src="../../BACK/JS LOGICA/checkout_card.js">
      document.addEventListener("DOMContentLoaded", () => {
      // ...
      mostrarFormularioPorMetodo("credit");
    });
    </script>
 <script>
document.addEventListener("DOMContentLoaded", () => {
  function mostrarFormularioPorMetodo(metodo) {
    const formCredit = document.getElementById("formCredit");
    const formDebit = document.getElementById("formDebit");
    const formEfec = document.getElementById("formEfec");
    if (formCredit) formCredit.style.display = metodo === "credit" ? "" : "none";
    if (formDebit) formDebit.style.display = metodo === "debit" ? "" : "none";
    if (formEfec) formEfec.style.display = metodo === "cash" ? "" : "none";
  }

  function cargarResumen(idMetodoPago = 1) {
    fetch("../../BACK/PHP/finalizar_compra.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id_pagometodo: idMetodoPago, soloResumen: true })
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        console.error("Error:", data.error);
        return;
      }
      const resumen = data;
      const contenedor = document.getElementById("order-summary");
      const subtotal = document.getElementById("subtotal");
      const total = document.getElementById("summary-total");
      const descuentoRow = document.getElementById("descuento-row");
      const descuentoSpan = document.getElementById("descuento");

      if (contenedor) contenedor.innerHTML = "";

      if (resumen.items && resumen.items.length) {
        resumen.items.forEach(item => {
          const div = document.createElement("div");
          div.classList.add("order-item");
          div.innerHTML = `
            <p><strong>${item.nombre}</strong> x${item.cantidad}</p>
            <p>Precio: $${parseFloat(item.precio).toFixed(2)} | Total: $${parseFloat(item.total).toFixed(2)}</p>
          `;
          contenedor.appendChild(div);
        });
      }

      let montoDescuento = 0;
      if (resumen.descuento && parseFloat(resumen.descuento) > 0) {
        montoDescuento = (parseFloat(resumen.subtotal) * parseFloat(resumen.descuento) / 100);
        if (descuentoSpan) descuentoSpan.textContent = `- $${montoDescuento.toFixed(2)} (${resumen.descuento}% OFF)`;
        if (descuentoRow) descuentoRow.style.display = "";
      } else if (descuentoRow) {
        descuentoRow.style.display = "none";
      }

      if (subtotal) subtotal.textContent = `$${parseFloat(resumen.subtotal).toFixed(2)}`;
      if (total) total.textContent = `$${(parseFloat(resumen.subtotal) - montoDescuento).toFixed(2)}`;
      const elementos = document.getElementsByClassName("total-amount");
      Array.from(elementos).forEach(el => {
        el.textContent = ` - Total: $${(parseFloat(resumen.subtotal) - montoDescuento).toFixed(2)}`;
      });
    })
    .catch(err => {
      console.error("Error de red:", err);
    });
  }

  document.querySelectorAll(".payment-method").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".payment-method").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      mostrarFormularioPorMetodo(btn.dataset.method);
      const metodo = btn.dataset.method;
      const idMetodo = metodo === "credit" ? 1 : metodo === "debit" ? 2 : 3;
      cargarResumen(idMetodo);
    });
  });

  const btnActivo = document.querySelector(".payment-method.active");
  let idMetodo = 1;
  if (btnActivo) {
    const metodo = btnActivo.dataset.method;
    idMetodo = metodo === "credit" ? 1 : metodo === "debit" ? 2 : 3;
    mostrarFormularioPorMetodo(metodo);
  } else {
    mostrarFormularioPorMetodo("credit");
  }
  cargarResumen(idMetodo);
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {

    new FormHandler({
      formSelector: "#formCredit",
      endpoint: "../../BACK/PHP/finalizar_compra.php",
      messageTarget: document.querySelector("#formCredit .message-target")
      });
 

    new FormHandler({
      formSelector: "#formDebit",
      endpoint: "../../BACK/PHP/finalizar_compra.php",
      messageTarget: document.querySelector("#formDebit .message-target")
      });

    new FormHandler({
      formSelector: "#formEfec",
      endpoint: "../../BACK/PHP/finalizar_compra.php",
      messageTarget: document.querySelector("#formEfec .message-target")
      });
  }
);
</script>
<script src="../JS DISEÑO/menu.js"></script>
</body>
</html>