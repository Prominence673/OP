<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Datos personales - ViajesMundo</title>
  <link rel="stylesheet" href="../CSS/header-footer.css"/>
  <link rel="stylesheet" href="../CSS/panel_usuario.css"/>
  <link rel="stylesheet" href="../CSS/toast.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    #formDatos {
  display: flex;
  flex-direction: column;
  gap: 1.5rem; 
  margin: 0 auto;
  padding: 1rem;
  background: #f9f9f9;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* Cada secci√≥n de grupo de campos alineados horizontalmente */
#formDatos .form-grid {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap; /* para que en pantallas chicas baje a otra l√≠nea */
}

/* Cada grupo de input+label dentro del grid */
#formDatos .form-group {
  flex: 1 1 45%; /* que ocupe aproximadamente la mitad, ajustable */
  display: flex;
  flex-direction: column;
}

/* Labels un poco destacados */
#formDatos label {
  font-weight: 600;
  margin-bottom: 0.4rem;
  color: #333;
}

/* Inputs y selects */
#formDatos input[type="text"],
#formDatos input[type="tel"],
#formDatos input[type="email"],
#formDatos select,
#formDatos input[type="password"] {
  padding: 0.5rem 0.7rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

#formDatos input[type="text"]:focus,
#formDatos input[type="tel"]:focus,
#formDatos input[type="email"]:focus,
#formDatos select:focus,
#formDatos input[type="password"]:focus {
  border-color: #3b82f6; /* azul foco */
  outline: none;
}

/* Para la secci√≥n de g√©nero que est√° en l√≠nea */
#formDatos .form-group:last-child > div {
  gap: 1.5rem;
}

/* Bot√≥n de guardar */
#formDatos button[type="submit"] {
  align-self: flex-start; /* para que no quede estirado */
  padding: 0.7rem 1.5rem;
  font-size: 1.1rem;
  font-weight: 600;
  color: #3b82f6;
  border: 2px solid #3b82f6;
  border-radius: 6px;
  background: transparent;
  cursor: pointer;
  margin-top: 2rem;
  transition: background-color 0.3s ease, color 0.3s ease;
}

#formDatos button[type="submit"]:hover {
  background-color: #3b82f6;
  color: white;
}

    .form-section {
      margin-bottom: 2.5rem;
      padding: 1.5rem 1rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .form-section:not(:last-child) {
      border-bottom: 2px solid #f0f0f0;
    }
    .form-section h3 {
      margin-bottom: 1rem;
    }
    .form-section form {
      margin-top: 1rem;
    }
    .form-section .btn-outline,
    .form-section .btn-primary {
      margin-top: 1.2rem;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-container">
      <div class="logo-titulo">
        <a href="index.html">
          <img src="../../SOURCE/KAPIFLY.png" alt="Logo Kapifly" class="logo-img-real">
        </a>
      </div>
      <nav class="main-nav">
        <ul class="nav-menu">
          <li><a href="index.html">Inicio</a></li>
          <li class="dropdown-parent">
            <button class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">
              Paquetes <i class="fa-solid fa-chevron-down"></i>
            </button>
            <ul class="submenu">
              <li><a href="coches.html">Alquiler coches</a></li>
              <li><a href="paquetes.html">Paquetes turisticos</a></li>
              <li><a href="estadias.html">Estadias</a></li>
              <li><a href="pasajes.html">Pasajes a√©reos</a></li>
            </ul>
          </li>
          <li><a href="contacto.html">Contacto</a></li>
        </ul>
      </nav>
      <div class="user-menu">
        <a href="carrito.html" aria-label="Ir al carrito de compras" class="icon-link">
          <i class="fa-solid fa-cart-shopping user-icon"></i>
        </a>
        <button id="user-menu-btn" aria-label="Men√∫ de usuario" class="icon-btn">
          <i class="fa-solid fa-user user-icon"></i>
        </button>
        <button id="toggle-dark" class="darkmode-toggle" aria-label="Cambiar modo oscuro">
          <i class="fa-solid fa-moon" id="darkmode-icon"></i>
        </button>
        <ul class="dropdown">
          <li id="user"></li>
          <li id="panel_usuario"><a href="panel_usuario.html">Panel</a></li>
          <li id="panel_admin" style="display: none;"><a href="admin.html">Panel Admin</a></li>
          <li id="login_panel"><a href="login.html">Iniciar sesi√≥n</a></li>
          <li id="register_panel"><a href="register.html">Registrarse</a></li>
          <li><a href="#" id="logout">Cerrar Sesion</a></li>
        </ul>
      </div>
  </header>

<main class="panel-container">
  <aside class="sidebar">
    <div class="sidebar-card">
      <h3>üöÄ Plane√° tu nuevo viaje!</h3>
      <p>Aprovech√° las ofertas en alojamientos, vuelos, actividades y mucho m√°s.</p>
      <button class="btn-primary" onclick="window.location.href='paquetes.html'">Encontr√° tu vuelo</button>
    </div>
    <ul class="sidebar-menu">
      <li><a href="panel_usuario.html"><i class="fas fa-user"></i> Datos personales</a></li>
    </ul>
  </aside>

  <section class="main-panel">
    <section class="panel-section">
      <h2><span>Mi Perfil</span> / Datos personales</h2>
      <div class="user-profile-header">
        <div class="user-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="user-info">
          <h3 id="user-name">Nombre Apellido</h3>
          <div style="display: flex; align-items: center; gap: 0.5em;">
            <i class="fas fa-envelope"></i>
            <span class="email"></span>
            <i class="fas fa-check-circle" id="icon-verificacion" style="color: rgb(81, 255, 0);"></i>
            <i class="fas fa-phone"></i>+<div id="telefonoActual">Numero de telefono</div>
          </div>
        </div>
      </div>
    </section>

    <div class="form-section">
      <h3><i class="fas fa-id-card"></i> Informaci√≥n b√°sica</h3>
      <p>Actualiz√° tus datos personales para una mejor experiencia.</p>
      <form id="formDatos" method="post" autocomplete="off">
        <input type="hidden" name="action" value="guardar_datos" />
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Nombres</label>
            <input type="text" id="name" name="name" placeholder="Como figura en el documento" required maxlength="50"/>
          </div>
          <div class="form-group">
            <label for="surname">Apellidos</label>
            <input type="text" id="surname" name="surname" placeholder="Como figura en el documento" required maxlength="50"/>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Fecha de nacimiento</label>
            <div style="display: flex; gap: 0.5rem;">
              <select id="dia" name="dia" style="flex: 1;"></select>
              <select id="mes" name="mes" style="flex: 1;"></select>
              <select id="anio" name="anio" style="flex: 1;"></select>
            </div>
          </div>
          <div class="form-group">
            <label for="dni">DNI</label>
            <input type="text" id="dni" name="dni" placeholder="Ej: 30123456" required maxlength="11"/>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label for="provincia">Provincia</label>
            <select id="provincia" name="provincia" required>
              <option value="">Eleg√≠ provincia...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="localidad">Localidad</label>
            <select id="localidad" name="localidad" required disabled>
              <option value="">Primero provincia...</option>
            </select>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label for="partido">Partido</label>
            <select id="partido" name="partido" required disabled>
              <option value="">Primero localidad...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="codigo_postal">C√≥digo Postal</label>
            <input type="text" id="codigo_postal" name="codigo_postal" maxlength="8" required/>
          </div>
        </div>
        <div class="form-group">
          <label>G√©nero</label>
          <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
            <label style="display:flex;align-items:center;gap:0.4em;">
              <input type="radio" name="genero" value="Femenino"> Femenino
            </label>
            <label style="display:flex;align-items:center;gap:0.4em;">
              <input type="radio" name="genero" value="Masculino" checked> Masculino
            </label>
          </div>
        </div>
        <div id="divDatos"></div>
        <button class="btn-outline" type="submit">Guardar cambios</button>
      </form>
    </div>


    <div class="form-section">
      <h3><i class="fas fa-phone"></i> Tel√©fonos</h3>
      <p>Agreg√° tus tel√©fonos para que podamos contactarte.</p>
      <button type="button" class="btn-outline" onclick="document.getElementById('telefonoForm').classList.toggle('hidden')">
        <i class="fas fa-plus"></i> Agregar tel√©fono
      </button>
      <form id="telefonoForm" method="post" class="hidden" style="margin-top: 1.5rem;" autocomplete="off">
        <input type="hidden" name="action" value="guardar_telefono" />
        <div class="form-grid">
          <div class="form-group">
            <label for="telefono">N√∫mero de tel√©fono</label>
            <input type="tel" name="telefono" id="telefono" placeholder="Ej: +54 9 11 1234-5678" required maxlength="12">
          </div>
          <div id="divTelefono"></div>
        </div>
        <button class="btn-primary" type="submit">Guardar tel√©fono</button>
      </form>
    </div>


    <div class="form-section">
      <h3><i class="fas fa-envelope"></i> Email</h3>
      <p>Cambi√° el email vinculado a esta cuenta.</p>
      <form id="formEmail" method="post" autocomplete="off">
        <input type="hidden" name="action" value="guardar_email" />
        <div class="form-grid">
          <div class="form-group">
            <label for="email">Nuevo email</label>
            <input type="email" name="email" id="email" placeholder="nuevo@email.com" required maxlength="255">
          </div>
          <div id="divEmail"></div>
        </div>
        <button class="btn-outline" type="submit">
          <i class="fas fa-paper-plane"></i> Cambiar Email
        </button>
      </form>
    </div>

    <div class="form-section">
      <h3><i class="fas fa-lock"></i> Contrase√±a</h3>
      <p>Cambi√° tu contrase√±a peri√≥dicamente para mayor seguridad.</p>
      <button type="button" class="btn-outline" onclick="document.getElementById('formPass').classList.toggle('hidden')">
        <i class="fas fa-pen"></i> Cambiar contrase√±a
      </button>
      <form id="formPass" method="post" class="hidden" style="margin-top: 1.5rem;" autocomplete="off">
        <input type="hidden" name="action" value="cambiar_contra" />
        <div class="form-grid">
          <div class="form-group">
            <label for="currentpassword">Contrase√±a actual</label>
            <input type="password" name="currentpassword" id="currentpassword" placeholder="Contrase√±a actual" required maxlength="16">
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label for="password">Nueva contrase√±a</label>
            <input type="password" name="password" id="password" placeholder="Nueva contrase√±a" required maxlength="16">
          </div>
          <div class="form-group">
            <label for="confirmpassword">Confirmar nueva contrase√±a</label>
            <input type="password" name="confirmpassword" id="confirmpassword" placeholder="Repetir nueva contrase√±a" required maxlength="16">
          </div>
        </div>
        <div class="form-group checkbox-group">
          <input type="checkbox" id="show-password">
          <label for="show-password">Mostrar contrase√±as</label>
          <div id="divPass"></div>
        </div>
        <button class="btn-primary" type="submit">Actualizar contrase√±a</button>
      </form>
    </div>
  </section>
</main>

<script>

const dia = document.getElementById("dia");
const mes = document.getElementById("mes");
const anio = document.getElementById("anio");

const meses = [
  "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
];

meses.forEach((m, i) => {
  const opt = document.createElement("option");
  opt.value = i + 1;
  opt.textContent = m;
  mes.appendChild(opt);
});

function actualizarDias() {
  dia.innerHTML = "";
  const mesSeleccionado = parseInt(mes.value);
  const anioSeleccionado = parseInt(anio.value);
  const diasEnMes = new Date(anioSeleccionado, mesSeleccionado, 0).getDate();
  for (let i = 1; i <= diasEnMes; i++) {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = i;
    dia.appendChild(opt);
  }
}

for (let y = 1925; y <= 2007; y++) {
  const opt = document.createElement("option");
  opt.value = y;
  opt.textContent = y;
  anio.appendChild(opt);
}

mes.addEventListener("change", actualizarDias);
anio.addEventListener("change", actualizarDias);
anio.value = "2001";
mes.value = "8";
actualizarDias();
dia.value = "17";


document.getElementById('show-password').addEventListener('change', function() {
  const current = document.getElementById('currentpassword');
  const newPass = document.getElementById('password');
  const confirm = document.getElementById('confirmpassword');
  const type = this.checked ? 'text' : 'password';
  
  current.type = type;
  newPass.type = type;
  confirm.type = type;
});
</script>
<script>
const baseURL = 'https://apis.datos.gob.ar/georef/api';



const selProv = document.getElementById('provincia');
const selLoc = document.getElementById('localidad');
const selPar = document.getElementById('partido');


async function cargarProvincias() {
  const res = await fetch(`${baseURL}/provincias?campos=id,nombre&max=100`);
  const json = await res.json();
  json.provincias.forEach(p => selProv.add(new Option(p.nombre, p.id)));
}

async function cargarLocalidades() {
  const provId = selProv.value;
  selLoc.innerHTML = '<option value="">Eleg√≠ localidad...</option>';
  selPar.innerHTML = '<option value="">Primero localidad...</option>';
  selPar.disabled = true;
  if (!provId) { selLoc.disabled = true; return; }
  selLoc.disabled = false;
  const res = await fetch(`${baseURL}/localidades?provincia=${provId}&campos=id,nombre&max=200`);
  (await res.json()).localidades.forEach(l => selLoc.add(new Option(l.nombre, l.id)));
}


async function cargarPartidos() {
  const locId = selLoc.value;
  selPar.innerHTML = '<option value="">Eleg√≠ partido...</option>';
  if (!locId) { selPar.disabled = true; return; }
  selPar.disabled = false;
  const res = await fetch(`${baseURL}/localidades?id=${locId}&campos=departamento.id,departamento.nombre`);
  const dep = (await res.json()).localidades[0].departamento;
  selPar.add(new Option(dep.nombre, dep.id));
}

selProv.addEventListener('change', cargarLocalidades);
selLoc.addEventListener('change', cargarPartidos);

document.addEventListener('DOMContentLoaded', async () => {
  await cargarProvincias();

  selProv.value = '06';
  await cargarLocalidades();
});
</script>
<script src="../../BACK/JS LOGICA/sessionActivate.js"></script>
<script>
const actions = new SessionActions();
actions.Disabled(["#login_panel", "#register_panel"],"none", "0.5", "none");
actions.Activate(["#panel_usuario", "#logout"], "none", "0.5", "none" );
actions.InsertData("#user", "nombre");
actions.InsertData("#user-name", "nombre");
actions.InsertData(".email", "email");
actions.AdminOnlyToggle(["#panel_admin"], []);
actions.checkSessionAndRedirectIfNotLoggedIn("login.html");
const logout = document.getElementById("logout");
logout.addEventListener("click", () => {
  actions.logoutSession();
});
</script>

<script src="../JS DISE√ëO/menu.js"></script>
<script src="../../BACK/JS LOGICA/submitdata.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  new FormHandler({
    formSelector: "#formDatos", 
    endpoint: "../../BACK/PHP/user_panel.php",  
    messageTarget: divDatos
    
  });
  
  new FormHandler({
    formSelector: "#telefonoForm", 
    endpoint: "../../BACK/PHP/user_panel.php",  
    messageTarget: divTelefono
   
  });
  
  new FormHandler({
    formSelector: "#formEmail", 
    endpoint: "../../BACK/PHP/user_panel.php",  
    messageTarget: divEmail
   
  });
  
  new FormHandler({
    formSelector: "#formPass", 
    endpoint: "../../BACK/PHP/user_panel.php",  
    messageTarget: divPass
    
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  fetch("../../BACK/PHP/user_panel.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action: "traer_datos_personales" })
  })
  .then(res => res.json())
  .then(async data => {
    if (data.success && data.datos) {
      const d = data.datos;
      document.getElementById("name").value = d.nombre || "";
      document.getElementById("surname").value = d.apellido || "";
      if (d.fecha_nacimiento) {
        const [anio, mes, dia] = d.fecha_nacimiento.split("-");
        document.getElementById("anio").value = anio;
        document.getElementById("mes").value = parseInt(mes, 10);
        document.getElementById("dia").value = parseInt(dia, 10);
      }
      document.getElementById("dni").value = d.dni || "";
      document.getElementById("codigo_postal").value = d.codigo_postal || "";
      if (d.sexo) {
        const radios = document.querySelectorAll('input[name="genero"]');
        radios.forEach(r => { r.checked = (r.value === d.sexo); });
      }
      if (d.telefono) {
        document.getElementById("telefonoActual").innerHTML = d.telefono;
      }
      // Provincia, Localidad, Partido (rellena en orden)
      if (d.id_provincia) {
        document.getElementById("provincia").value = d.id_provincia;
        await cargarLocalidades(); // Espera a que se carguen las localidades
        if (d.id_localidad) {
          document.getElementById("localidad").value = d.id_localidad;
          await cargarPartidos(); // Espera a que se cargue el partido
          if (d.id_partido) {
            document.getElementById("partido").value = d.id_partido;
          }
        }
      }
    }
  });
});
</script>
<footer class="site-footer">
  <div class="footer-container">
    <div class="footer-brand">
      <img src="../../SOURCE/KAPIFLY.png" alt="KAPIFLY Logo" class="footer-logo-img" style="height:48px;">      
      <span class="footer-desc">Viajes y experiencias √∫nicas</span>
    </div>
    <div class="footer-links">
      <a href="../HTML/contacto.html" class="footer-link">Contacto</a>
      <a href="#" class="footer-link">T√©rminos</a>
      <a href="#" class="footer-link">Privacidad</a>
      <a href="../HTML/contacto.html" class="footer-link">Preguntas frecuentes</a>
    </div>
    <div class="footer-social">
      <a href="#" class="footer-social-link" title="Twitter"><i class="fab fa-twitter"></i></a>
      <a href="#" class="footer-social-link" title="Instagram"><i class="fab fa-instagram"></i></a>
      <a href="#" class="footer-social-link" title="Tiktok"><i class="fab fa-tiktok"></i></a>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 KAPIFLY. Todos los derechos reservados.</p>
  </div>
</footer>
<div id="toast-msg"></div>
<script src="../JS DISE√ëO/darkmode.js"></script>
</body>
</html>